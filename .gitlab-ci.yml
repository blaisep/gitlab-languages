image: python:3.6-stretch


stages:
  - lint
  - run

flake8:
  stage: lint
  before_script:
    - python3 -m venv venv
    - source venv/bin/activate
    - pip install -r requirements_dev.txt
  script:
    - flake8 .

pages:
  stage: run
  before_script:
    - python3 -m venv venv
    - source venv/bin/activate
    - pip install -r requirements.txt
    - pip install -U git+https://github.com/python-gitlab/python-gitlab.git # this feature requires python-gitlab > 1.4.0
  script:
    - python3 gitlab_languages.py --projectlimit 10
    - mv metrics.txt public/
  artifacts:
    expire_in: 1 week
    paths:
      - public
  only:
    - master
